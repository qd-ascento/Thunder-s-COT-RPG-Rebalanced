LinkLuaModifier("modifier_boss_kel_thuzad_invulnerability_magical", "heroes/bosses/kel_thuzad/invulnerability.lua", LUA_MODIFIER_MOTION_NONE)
LinkLuaModifier("modifier_boss_kel_thuzad_invulnerability_physical", "heroes/bosses/kel_thuzad/invulnerability.lua", LUA_MODIFIER_MOTION_NONE)

boss_kel_thuzad_invulnerability = class({
	GetIntrinsicModifierName = function() return "modifier_boss_kel_thuzad_invulnerability_magical" end,
})

function boss_kel_thuzad_invulnerability:GetCooldown()
	local caster = self:GetCaster()
	local stacks = caster:GetModifierStackCount("modifier_boss_kel_thuzad_immortality", caster)
	return self:GetSpecialValueFor(caster:HasModifier("modifier_boss_kel_thuzad_immortality") and stacks <= self:GetSpecialValueFor("reduced_stacks") and "reduced_cooldown" or "normal_cooldown")
end

if IsServer() then
	function boss_kel_thuzad_invulnerability:OnToggle()
		local caster = self:GetCaster()
		if self:GetToggleState() then
			caster:RemoveModifierByName("modifier_boss_kel_thuzad_invulnerability_magical")
			caster:AddNewModifier(caster, self, "modifier_boss_kel_thuzad_invulnerability_physical", nil)
		else
			self:StartCooldown(self:GetCooldown())
			caster:RemoveModifierByName("modifier_boss_kel_thuzad_invulnerability_physical")
			caster:AddNewModifier(caster, self, "modifier_boss_kel_thuzad_invulnerability_magical", nil)
		end
	end
end


modifier_boss_kel_thuzad_invulnerability_magical = class({})
function modifier_boss_kel_thuzad_invulnerability_magical:DeclareFunctions()
	return {MODIFIER_PROPERTY_ABSOLUTE_NO_DAMAGE_MAGICAL}
end
function modifier_boss_kel_thuzad_invulnerability_magical:GetAbsoluteNoDamageMagical()
	return 1
end

modifier_boss_kel_thuzad_invulnerability_physical = class({})
function modifier_boss_kel_thuzad_invulnerability_physical:DeclareFunctions()
	return {MODIFIER_PROPERTY_ABSOLUTE_NO_DAMAGE_PHYSICAL}
end
function modifier_boss_kel_thuzad_invulnerability_physical:GetAbsoluteNoDamagePhysical()
	return 1
end
